{% extends 'masonry.html' %}

{% block title %}Login{% endblock %}

{% block content %}

{% if error_message %}
<p style="color: red;">{{ error_message }}</p>
{% endif %}

<div class="justify-content-Start">
    <div class="col-3">
        <form method="post" style="max-width: 300px;">
            {% csrf_token %}
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" class="form-control">
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" class="form-control">
            </div>
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary my-3">Login</button>
            </div>
        </form>
        <div class="d-grid gap-2" style="max-width: 300px;">
            <button id="login-with-passkey" class="btn btn-dark">Login with passkey</button>
            <p>*username required for passkeys</p>
        </div>
        <p class="mt-3">Don't have an account? <a href="{% url 'signup' %}">Sign Up</a></p>
    </div>
</div>

<script>
    
    document.addEventListener("DOMContentLoaded", function() {
        const loginWithPasskeyButton = document.getElementById('login-with-passkey');

        loginWithPasskeyButton.addEventListener('click', function(event) {
            const username = document.getElementById('username').value;
            if (username.trim() === '') {
                alert("Username required for passkeys");
                return;
            }

            const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/web_auth/login_with_passkey/';

            const inputUsername = document.createElement('input');
            inputUsername.type = 'hidden';
            inputUsername.name = 'username';
            inputUsername.value = username;
            form.appendChild(inputUsername);

            const inputCsrfToken = document.createElement('input');
            inputCsrfToken.type = 'hidden';
            inputCsrfToken.name = 'csrfmiddlewaretoken';
            inputCsrfToken.value = csrfToken;
            form.appendChild(inputCsrfToken);

            document.body.appendChild(form);
            form.submit();
        });
    });
</script>

{% endblock %}